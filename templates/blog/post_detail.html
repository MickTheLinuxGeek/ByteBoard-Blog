{% extends "blog/base.html" %}
{% load reactpy %}

{% block meta_title %}{{ post.meta_title|default:post.title }}{% endblock %}
{% block meta_description %}{{ post.meta_description|default:post.content|truncatewords:25 }}{% endblock %}
{% block meta_keywords %}{% for tag in post.tags.all %}{{ tag.name }}{% if not forloop.last %}, {% endif %}{% endfor %}{% endblock %}

{% block og_type %}article{% endblock %}

{# --- Open Graph Blocks --- #}
{% block og_title %}{{ post.og_title|default:post.title }}{% endblock %}
{% block og_description %}{{ post.og_description|default:post.meta_description|default:post.content|striptags|truncatewords:25 }}{% endblock %}
{% block og_image %}
    {% if post.image %}
        {{ request.scheme }}://{{ request.get_host }}{{ post.image.url }}
    {% endif %}
{% endblock %}

{# --- Twitter Blocks (mirroring the OG content) --- #}
{% block twitter_title %}{{ post.og_title|default:post.title }}{% endblock %}
{% block twitter_description %}{{ post.og_description|default:post.meta_description|default:post.content|striptags|truncatewords:25 }}{% endblock %}
{% block twitter_image %}
    {% if post.image %}
        {{ request.scheme }}://{{ request.get_host }}{{ post.image.url }}
    {% endif %}
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
{% endblock %}

{% block content %}
    {% if post.id %}
        {% component "blog.components.PostDetail" post_id=post.id %}
    {% else %}
        <div class="alert alert-danger">Invalid post</div>
    {% endif %}

    <div class="d-flex justify-content-between mb-4">
        <div>
            <a href="{% url 'blog:home' %}" class="btn btn-outline-primary">&larr; Back to Posts</a>
        </div>

        <div class="social-sharing">
            <form action="{% url 'blog:share_post' post.id %}" method="post">
                {% csrf_token %}
                <button type="submit" name="mastodon" class="btn btn-outline-primary">Share on Mastodon</button>
                <button type="submit" name="bluesky" class="btn btn-outline-primary">Share on BlueSky</button>
            </form>

            {% if messages %}
                <ul class="messages">
                    {% for message in messages %}
                        <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>
    </div>
        <!--
        <div class="social-sharing">
            <span class="me-2">Share:</span>
            <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text={{ post.title }}" 
               target="_blank" class="btn btn-sm btn-outline-primary me-1">
                Twitter
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" 
               target="_blank" class="btn btn-sm btn-outline-primary me-1">
                Facebook
            </a>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ request.build_absolute_uri }}&title={{ post.title }}" 
               target="_blank" class="btn btn-sm btn-outline-primary">
                LinkedIn
            </a>
        </div>
        -->

    <!--
    Disqus Comments
    <div id="disqus_thread" class="mt-5"></div>
    <script>
        var disqus_config = function () {
            this.page.url = '{{ request.build_absolute_uri }}';
            this.page.identifier = '{{ post.slug }}';
        };
        (function() {
            var d = document, s = d.createElement('script');
            s.src = 'https://byteboard.disqus.com/embed.js';  // Replace with your Disqus shortname
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    -->
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('pre code').forEach((el) => {
            hljs.highlightElement(el);
        });
    });
</script>
{% endblock %}
